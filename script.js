(function () {
  window.DETAILS = {
    1: {
      title: "Piala E-Sport Champion Mobile Legends Papua",
      desc: `<p>Turnamen Mobile Legends Papua menjadi bukti pesatnya perkembangan e-sport di Indonesia. Ajang ini menghadirkan persaingan yang seru sekaligus mempererat persaudaraan antarpemain dalam suasana kompetitif yang sehat.</p>
<p>Trofi yang diperebutkan hadir sebagai <a href="https://troppion.com/piala-event/piala-olahraga/piala-e-sport/" target="_blank" rel="noopener" class="highlight-link">Piala e-sport</a> berbahan resin bening yang elegan dipadukan logam berlapis emas. Perpaduan material ini menonjolkan kesan mewah, modern, dan layak menjadi simbol kejayaan.</p>
<p>Jika Anda sedang menyiapkan kejuaraan, Troppion siap membantu merancang penghargaan kustom melalui koleksi <a href="https://troppion.com/piala-event/piala-olahraga/" target="_blank" rel="noopener" class="highlight-link">Piala Olahraga</a> yang bisa disesuaikan dengan identitas acara Anda.</p>`,
    },

    2: {
      title: "Piala E-Sport M-Well Championship Mobile Legend Kudus",
      desc: `<p>M-Well Championship mempertemukan para penggemar Mobile Legends untuk adu strategi dalam pertandingan yang intens. Kompetisi ini menghadirkan atmosfer prestisius sekaligus memperkuat kebersamaan komunitas gamer.</p>
<p>Piala yang diperebutkan merupakan <a href="https://troppion.com/piala-event/piala-olahraga/piala-e-sport/" target="_blank" rel="noopener" class="highlight-link">Piala e-sport</a> eksklusif berbahan resin estetik dengan aksen glitter emas. Desainnya tampil berkelas dan inovatif, menjadikannya simbol kemenangan yang berkesan.</p>
<p>Ingin menghadirkan apresiasi yang tak terlupakan di turnamen Anda? Jelajahi opsi kustom dari Troppion melalui kategori <a href="https://troppion.com/piala-event/piala-olahraga/" target="_blank" rel="noopener" class="highlight-link">Piala Olahraga</a> untuk desain yang sesuai konsep dan kebutuhan acara.</p>`,
    },

    3: {
      title: "Piala Poco Indonesia – Poco Extreme League",
      desc: `<p>Poco Extreme League menjadi panggung bagi gamer Indonesia untuk menunjukkan kemampuan terbaik. Selain kompetisi yang menegangkan, ajang ini juga memperkuat ikatan komunitas lewat semangat fair play.</p>
<p>Para juara berhak atas <a href="https://troppion.com/piala-event/piala-olahraga/piala-e-sport/" target="_blank" rel="noopener" class="highlight-link">Piala e-sport</a> berbalut kombinasi resin dan logam berkualitas. Setiap detailnya memancarkan energi dan dinamika khas dunia e-sport, sekaligus memuliakan capaian juara.</p>
<p>Penyelenggara dapat memesan trofi yang sepenuhnya dipersonalisasi melalui lini <a href="https://troppion.com/piala-event/piala-olahraga/" target="_blank" rel="noopener" class="highlight-link">Piala Olahraga</a> Troppion—dirancang elegan, tahan lama, dan penuh makna.</p>`,
    },

    4: {
      title:
        "Piala Bergilir Best Competition 5R Area Mess PT Cipta Kridatama – MHU Project Samarinda",
      desc: `<p>Kompetisi 5R (Ringkas, Rapi, Resik, Rawat, Rajin) di Area Mess PT Cipta Kridatama – MHU Project Samarinda mendorong terciptanya lingkungan kerja yang bersih, aman, dan produktif. Program ini mengajak seluruh tim menerapkan budaya kerja yang tertib dan berkelanjutan.</p>
<p>Terinspirasi estetika modern ajang gim, penghargaan diwujudkan sebagai <a href="https://troppion.com/piala-event/piala-olahraga/piala-e-sport/" target="_blank" rel="noopener" class="highlight-link">Piala e-sport</a> bergengsi dengan kombinasi kayu dan logam. Wujudnya bukan sekadar trofi, melainkan simbol komitmen terhadap kualitas dan ketertiban.</p>
<p>Untuk acara internal perusahaan maupun turnamen lintas unit, Troppion menyediakan layanan kustom melalui kategori <a href="https://troppion.com/piala-event/piala-olahraga/" target="_blank" rel="noopener" class="highlight-link">Piala Olahraga</a> agar desain selaras dengan nilai, logo, dan identitas organisasi Anda.</p>`,
    },

    5: {
      title: "Piala Bergilir Penerapan K3 Terbaik Perum Jasa Tirta 1 Malang",
      desc: `<p>Penghargaan “K3 Terbaik” Perum Jasa Tirta 1 Malang diberikan untuk apresiasi atas penerapan keselamatan dan kesehatan kerja yang unggul. Inisiatif ini menegaskan komitmen perusahaan terhadap kesejahteraan dan keamanan karyawan.</p>
<p>Trofi bergengsi dirancang sebagai <a href="https://troppion.com/piala-event/piala-olahraga/piala-e-sport/" target="_blank" rel="noopener" class="highlight-link">Piala e-sport</a> dengan kombinasi logam dan resin, menghadirkan tampilan kuat sekaligus elegan. Kehadirannya menegaskan prestasi nyata dalam menjaga standar K3.</p>
<p>Bagi institusi yang ingin menumbuhkan budaya kerja aman melalui apresiasi, pilih opsi kustom Troppion pada lini <a href="https://troppion.com/piala-event/piala-olahraga/" target="_blank" rel="noopener" class="highlight-link">Piala Olahraga</a> untuk trofi yang relevan dan penuh nilai.</p>`,
    },

    6: {
      title: "Piala Bergilir E-Sport Mobile Legends RS Persahabatan Jakarta",
      desc: `<p>RS Persahabatan Jakarta menggelar turnamen Mobile Legends untuk mempererat kebersamaan dan membangun semangat tim. Kompetisi ini menjadi ruang positif bagi karyawan dan komunitas sekitar untuk beradu strategi secara sportif.</p>
<p>Ikon kejuaraan dihadirkan sebagai <a href="https://troppion.com/piala-event/piala-olahraga/piala-e-sport/" target="_blank" rel="noopener" class="highlight-link">Piala e-sport</a> berbahan logam dengan detail tegas. Desainnya memancarkan karakter mewah, selaras dengan nilai sportivitas dan kolaborasi.</p>
<p>Untuk turnamen internal atau antar komunitas, wujudkan penghargaan yang berkesan bersama Troppion melalui pilihan <a href="https://troppion.com/piala-event/piala-olahraga/" target="_blank" rel="noopener" class="highlight-link">Piala Olahraga</a> yang siap dipersonalisasi.</p>`,
    },

    7: {
      title: "Piala Best In Culture Program Corporate SBU Kalla Makassar",
      desc: `<p>Corporate SBU Kalla Makassar konsisten mendorong inovasi dan keunggulan budaya kerja melalui berbagai program. Penghargaan Best In Culture menjadi apresiasi bagi tim yang menghidupkan nilai perusahaan secara efektif.</p>
<p>Trofi dirancang modern ala <a href="https://troppion.com/piala-event/piala-olahraga/piala-e-sport/" target="_blank" rel="noopener" class="highlight-link">Piala e-sport</a> dengan kombinasi logam dan resin. Wujudnya menonjolkan performa dan nilai, menjadikannya simbol motivasi untuk terus berprestasi.</p>
<p>Butuh penghargaan untuk program budaya maupun kegiatan olahraga? Pilih desain kustom melalui katalog <a href="https://troppion.com/piala-event/piala-olahraga/" target="_blank" rel="noopener" class="highlight-link">Piala Olahraga</a> dari Troppion yang siap disesuaikan.</p>`,
    },

    8: {
      title: "Piala PBNC Champion",
      desc: `<p>Gelar PBNC Champion menandai puncak prestasi di ajang Point Blank National Championship. Kemenangan ini lahir dari ketekunan berlatih, strategi matang, dan kerja sama tim yang solid.</p>
<p>Kemenangan dimahkotai dengan <a href="https://troppion.com/piala-event/piala-olahraga/piala-e-sport/" target="_blank" rel="noopener" class="highlight-link">Piala e-sport</a> berbahan logam berkualitas tinggi dan desain tegas. Trofi ini merepresentasikan kebanggaan sekaligus standar tertinggi dalam kompetisi.</p>
<p>Rayakan setiap gelar dengan trofi yang memikat dan tahan lama melalui koleksi kustom <a href="https://troppion.com/piala-event/piala-olahraga/" target="_blank" rel="noopener" class="highlight-link">Piala Olahraga</a> dari Troppion—dirancang khusus untuk menonjolkan identitas tim Anda.</p>`,
    },
  };
  /* ===================== 2) GAMBAR BERURUTAN ===================== */
  const IMG_SEQ_CONFIG = {
    basePath: "assets/images",
    prefix: "esport",
    start: 1,
    total: 27,
    ext: "jpg", // default: mayoritas file kamu .jpg
    exts: ["webp", "jpg", "jpeg", "png", "gif"], // urutan fallback
  };

  // yang .webp: 1–3
  const EXT_BY_INDEX = { 111: "webp", 21: "webp", 31: "webp" };

  function urlForImage(idx, cfg = IMG_SEQ_CONFIG, extOverride) {
    const chosenExt = extOverride || EXT_BY_INDEX[idx] || cfg.ext;
    return `${cfg.basePath}/${cfg.prefix}${idx}.${chosenExt}`;
  }

  /** set <img> dengan fallback ke daftar ekstensi */
  function setImageWithFallback(imgEl, idx, cfg = IMG_SEQ_CONFIG) {
    // mulai dari ext khusus (kalau ada), lalu coba sisa exts
    const firstExt = EXT_BY_INDEX[idx] || cfg.ext;
    const queue = [firstExt, ...cfg.exts.filter((e) => e !== firstExt)];
    let i = 0;

    function tryLoad() {
      imgEl.src = urlForImage(idx, cfg, queue[i]);
    }
    imgEl.onerror = () => {
      i++;
      if (i < queue.length) tryLoad();
      else {
        imgEl.onerror = null;
        imgEl.src =
          "https://images.unsplash.com/photo-1519681393600-7e08d64b9dc3?q=80&w=1200&auto=format&fit=crop";
      }
    };
    tryLoad();
  }

  function assignSequentialImages(cfg = IMG_SEQ_CONFIG) {
    const cards = Array.from(document.querySelectorAll(".product-card"));
    let idx = cfg.start;
    for (let i = 0; i < cards.length; i++) {
      if (idx > cfg.start - 1 + cfg.total) break;
      const card = cards[i];
      const btn = card.querySelector("[data-open-detail]");
      if (!btn) continue;

      const hasImg = (btn.getAttribute("data-img") || "").trim().length > 0;
      if (!hasImg) {
        const url = urlForImage(idx, cfg);
        btn.setAttribute("data-img", url);
        const thumb = card.querySelector(".product-thumb");
        if (thumb) thumb.src = url;
        idx++;
      }
    }
  }

  /* ===================== 3) UTIL ===================== */
  const DEFAULT_IMG =
    "https://images.unsplash.com/photo-1519681393600-7e08d64b9dc3?q=80&w=1200&auto=format&fit=crop";

  const slugify = (s = "") =>
    s
      .toString()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/[^a-z0-9]+/g, "-")
      .replace(/(^-|-$)+/g, "");

  const escapeHtml = (str = "") =>
    str.replace(
      /[&<>"']/g,
      (m) =>
        ({
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#039;",
        }[m])
    );

  /* ===================== 4) RENDER KARTU ===================== */
  function ensureCardThumbs() {
    const cards = document.querySelectorAll(".product-card");
    cards.forEach((card, idx) => {
      const btn = card.querySelector("[data-open-detail]");
      if (!btn) return;

      // Prioritas judul: DETAILS[data-id].title → data-title → H3 → "Produk X"
      const id = btn.dataset.id?.trim();
      const titleFromDetails = id && DETAILS[id]?.title;
      const dataTitle = btn.getAttribute("data-title")?.trim();
      const h3Existing = card.querySelector("h3")?.textContent?.trim();

      const title =
        titleFromDetails || dataTitle || h3Existing || `Produk ${idx + 1}`;

      const img = btn.getAttribute("data-img")?.trim() || DEFAULT_IMG;

      if (!card.id) card.id = `produk-${slugify(title)}`;

      const h3 = card.querySelector("h3");
      if (h3) {
        h3.textContent = title;
        h3.classList.add(
          "font-heading",
          "font-semibold",
          "text-lg",
          "product-title"
        );
      }

      if (!card.querySelector(".product-thumb")) {
        const wrap = card.querySelector(".reveal") || card;
        const imgEl = document.createElement("img");
        imgEl.className = "product-thumb w-full rounded-xl object-contain bg-white";
        imgEl.style.objectFit = "contain"; // pastikan pakai contain
        imgEl.style.borderRadius = "0"; // biar menempel ke pinggir
        imgEl.loading = "lazy";
        imgEl.src = img;
        imgEl.alt = title;
        wrap.prepend(imgEl);
      }
    });
  }

  /* ===================== 5) ANIMASI KARTU ===================== */
  const cards = Array.from(document.querySelectorAll(".product-card"));
  if (!("IntersectionObserver" in window) || cards.length === 0) {
    cards.forEach((c) => c.classList.add("in-view"));
  } else {
    const io = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const el = entry.target;
            const idx = cards.indexOf(el);
            el.style.transitionDelay = 80 * (idx % 8) + "ms";
            el.classList.add("in-view");
            io.unobserve(el);
          }
        });
      },
      { threshold: 0.2 }
    );
    cards.forEach((card) => io.observe(card));
  }

  /* ===================== 6) MODAL (Gambar Zoom + Judul + Deskripsi) ===================== */
  const modal = document.getElementById("detailModal");
  const titleEl = document.getElementById("detailTitle");
  const imgEl = document.getElementById("detailImg"); // akan dibungkus zoom-wrap
  const descEl = document.getElementById("detailDesc");
  const closeBtn = document.getElementById("closeModalBtn");

  // (opsional) Jika modal lama masih punya rating/keyword/kelebihan/kekurangan di HTML, hapus:
  (function removeExtraSections() {
    const ratingEl = document.getElementById("detailRating");
    if (ratingEl) {
      const grid = ratingEl.closest(".grid");
      if (grid) grid.remove();
    }
    const kwWrap = document.getElementById("detailKeywords")?.parentElement;
    if (kwWrap) kwWrap.remove();
  })();

  // Zoom state
  let zoom = { scale: 1, min: 1, max: 3, step: 0.25, panX: 0, panY: 0 };
  let zoomWrap;

  function wrapImageWithZoom() {
    if (!imgEl || imgEl.closest(".zoom-wrap")) return;
    zoomWrap = document.createElement("div");
    zoomWrap.className =
      "zoom-wrap relative overflow-hidden rounded-xl bg-gray-100";
    imgEl.parentNode.insertBefore(zoomWrap, imgEl);
    zoomWrap.appendChild(imgEl);

    const ctrls = document.createElement("div");
    ctrls.className = "zoom-controls absolute top-3 right-3 flex gap-2";
    ctrls.innerHTML = `
      <button type="button" class="zoom-btn rounded-md border px-2 py-1 bg-white" data-zoom="-">−</button>
      <button type="button" class="zoom-btn rounded-md border px-2 py-1 bg-white" data-zoom="+">+</button>
      <button type="button" class="zoom-btn rounded-md border px-2 py-1 bg-white" data-zoom="reset">Reset</button>
    `;
    zoomWrap.appendChild(ctrls);

    ctrls.addEventListener("click", (e) => {
      const z = e.target?.dataset?.zoom;
      if (z === "+") zoomIn();
      else if (z === "-") zoomOut();
      else if (z === "reset") resetZoom();
    });

    // Wheel-zoom
    zoomWrap.addEventListener(
      "wheel",
      (e) => {
        e.preventDefault();
        e.deltaY < 0 ? zoomIn() : zoomOut();
      },
      { passive: false }
    );

    // Double click reset
    imgEl.addEventListener("dblclick", resetZoom);

    // Drag-to-pan
    let isDown = false,
      startX = 0,
      startY = 0;
    zoomWrap.addEventListener("mousedown", (e) => {
      if (zoom.scale <= 1) return;
      isDown = true;
      zoomWrap.style.cursor = "grabbing";
      startX = e.clientX - zoom.panX;
      startY = e.clientY - zoom.panY;
    });
    window.addEventListener("mouseup", () => {
      isDown = false;
      zoomWrap.style.cursor = "";
    });
    zoomWrap.addEventListener("mousemove", (e) => {
      if (!isDown || zoom.scale <= 1) return;
      zoom.panX = e.clientX - startX;
      zoom.panY = e.clientY - startY;
      applyTransform();
    });
  }

  function applyTransform() {
    imgEl.style.transform = `translate(${zoom.panX}px, ${zoom.panY}px) scale(${zoom.scale})`;
    imgEl.style.transformOrigin = "center center";
    imgEl.style.transition = "transform 120ms ease";
  }
  function zoomIn() {
    zoom.scale = Math.min(zoom.max, zoom.scale + zoom.step);
    if (zoom.scale <= 1) zoom.panX = zoom.panY = 0;
    applyTransform();
  }
  function zoomOut() {
    zoom.scale = Math.max(zoom.min, zoom.scale - zoom.step);
    if (zoom.scale <= 1) zoom.panX = zoom.panY = 0;
    applyTransform();
  }
  function resetZoom() {
    zoom.scale = 1;
    zoom.panX = 0;
    zoom.panY = 0;
    applyTransform();
  }

  function openModal({ id, title, img, desc, cardId }) {
    // Jika ada ID & ditemukan di DETAILS, override title & desc dari sana
    if (id && DETAILS[id]) {
      title = DETAILS[id].title || title;
      desc = DETAILS[id].desc || desc;
    }

    titleEl.textContent = title || "";
    imgEl.src = img || DEFAULT_IMG;
    imgEl.alt = title || "Gambar produk";

    // Jika desc berasal dari DETAILS, itu HTML aman; kalau dari data-desc biasa → escape
    const isHtmlDesc = !!(id && DETAILS[id] && DETAILS[id].desc);
    const contentDesc = isHtmlDesc
      ? desc || ""
      : desc
      ? `<p>${escapeHtml(desc)}</p>`
      : "";

    const backlink = cardId
      ? `<br><br><a href="#${cardId}" class="detail-backlink text-brand underline font-semibold">Lihat produk di daftar</a>`
      : "";

    descEl.innerHTML = `${contentDesc}${backlink}`;

    resetZoom();
    modal.classList.remove("hidden");
    modal.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  }

  function closeModal() {
    modal.classList.add("hidden");
    modal.setAttribute("aria-hidden", "true");
    document.body.style.overflow = "";
  }

  // Delegasi klik tombol "Detail"
  document.addEventListener("click", (e) => {
    const btn = e.target.closest("[data-open-detail]");
    if (!btn) return;
    const card = btn.closest(".product-card");
    const id = btn.dataset.id?.trim(); // <-- ambil ID untuk lookup DETAILS
    const dataTitle =
      btn.getAttribute("data-title") ||
      card.querySelector("h3")?.textContent ||
      "";
    const img = btn.getAttribute("data-img") || DEFAULT_IMG;
    const dataDesc = btn.getAttribute("data-desc") || "";
    openModal({ id, title: dataTitle, img, desc: dataDesc, cardId: card?.id });
  });

  // Close handlers
  closeBtn?.addEventListener("click", closeModal);
  modal?.addEventListener("click", (e) => {
    if (e.target === modal || e.target.classList.contains("bg-black/50"))
      closeModal();
  });
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && !modal.classList.contains("hidden")) closeModal();
  });

  // ====== INIT (urutan penting) ======
  assignSequentialImages(); // isi data-img otomatis: assets/images/golf1.jpg, dst.
  ensureCardThumbs(); // render thumbnail + judul pada kartu
  wrapImageWithZoom(); // aktifkan zoom di modal
})();
(function () {
  const cvs = document.getElementById("goldParticles");
  const ctx = cvs.getContext("2d");
  const wrap = document.getElementById("trophyWrap");
  const img = document.getElementById("trophyImg");
  const dpr = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));

  let w = 0,
    h = 0,
    rect = null;
  let particles = [];
  let last = performance.now();

  // ====== PARAMETER TUNING ======
  const BASE_COUNT_DESKTOP = 110;
  const BASE_COUNT_MOBILE = 70;
  const GLOW_TRAIL = 0.22; // jejak (0=tidak ada, 1=hilang total)
  const MAX_DIST_FACTOR = 0.65; // seberapa jauh dari piala (0.4-0.8)
  const CENTER_PULL = 0.015; // tarikan ke pusat
  const WANDER = 0.35; // besaran gerak acak
  const SPEED = 32; // px/detik

  const isMobile = () => matchMedia("(max-width: 768px)").matches;

  function resizeCanvas() {
    rect = wrap.getBoundingClientRect();
    w = rect.width;
    h = rect.height;
    cvs.style.width = w + "px";
    cvs.style.height = h + "px";
    cvs.width = Math.floor(w * dpr);
    cvs.height = Math.floor(h * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }

  function getCenterAndRadius() {
    const i = img.getBoundingClientRect();
    const wr = wrap.getBoundingClientRect();
    const cx = (i.left + i.right) / 2 - wr.left;
    const cy = (i.top + i.bottom) / 2 - wr.top;
    // radius orbit dasar mengikuti ukuran piala
    const rx = i.width * MAX_DIST_FACTOR;
    const ry = i.height * MAX_DIST_FACTOR;
    return { cx, cy, rx, ry };
  }

  function spawnOne() {
    const { cx, cy, rx, ry } = getCenterAndRadius();
    // mulai di dekat elips piala
    const t = Math.random() * Math.PI * 2;
    const rj = 0.65 + Math.random() * 0.6; // variasi jarak
    const x = cx + Math.cos(t) * rx * rj;
    const y = cy + Math.sin(t) * ry * rj;

    const hue = 45 + Math.random() * 12;
    const size = 1.2 + Math.random() * 2.2;

    return {
      x,
      y,
      vx: (Math.random() - 0.5) * 10,
      vy: (Math.random() - 0.5) * 10,
      tw: Math.random() * Math.PI * 2, // fase kedip
      twSpeed: 2 + Math.random() * 3.5, // kecepatan kedip
      hue,
      sat: 90 + Math.random() * 10,
      light: 60 + Math.random() * 20,
      alpha: 0.65 + Math.random() * 0.35,
      size,
      sparkle: Math.random() < 0.18,
    };
  }

  function spawnAll() {
    particles = [];
    const count = isMobile() ? BASE_COUNT_MOBILE : BASE_COUNT_DESKTOP;
    for (let i = 0; i < count; i++) particles.push(spawnOne());
  }

  function step(dt) {
    const { cx, cy, rx, ry } = getCenterAndRadius();
    const maxR = Math.max(rx, ry) * 1.15;

    for (let i = particles.length - 1; i >= 0; i--) {
      const p = particles[i];

      // gerak acak (kunang-kunang): random walk + tarikan halus ke pusat
      p.vx += (Math.random() - 0.5) * WANDER;
      p.vy += (Math.random() - 0.5) * WANDER;

      p.vx += (cx - p.x) * CENTER_PULL * dt;
      p.vy += (cy - p.y) * CENTER_PULL * dt;

      // batasi kecepatan supaya lembut
      const maxV = SPEED;
      const vmag = Math.hypot(p.vx, p.vy);
      if (vmag > maxV) {
        p.vx = (p.vx / vmag) * maxV;
        p.vy = (p.vy / vmag) * maxV;
      }

      p.x += p.vx * dt;
      p.y += p.vy * dt;

      // jika terlalu jauh, teleport halus dekat orbit lagi
      const dist = Math.hypot(p.x - cx, p.y - cy);
      if (dist > maxR * 1.6) {
        const t = Math.random() * Math.PI * 2;
        p.x = cx + Math.cos(t) * maxR * 0.9;
        p.y = cy + Math.sin(t) * maxR * 0.9;
        p.vx *= 0.2;
        p.vy *= 0.2;
      }

      // update kedip
      p.tw += p.twSpeed * dt;
    }
  }

  function draw() {
    // fade agar ada trail lembut
    ctx.save();
    ctx.globalCompositeOperation = "destination-out";
    ctx.fillStyle = `rgba(0,0,0,${GLOW_TRAIL})`;
    ctx.fillRect(0, 0, w, h);
    ctx.restore();

    // gambar partikel
    particles.forEach((p) => {
      // flicker halus (0.75–1) + sparkle sesekali
      const flick = 0.75 + 0.25 * Math.sin(p.tw);
      const sparkleBoost = p.sparkle
        ? 0.25 + 0.75 * (Math.sin(p.tw * 3) * 0.5 + 0.5)
        : 0;
      const a = Math.min(1, p.alpha * flick + sparkleBoost * 0.25);

      // glow: lingkaran inti + halo
      ctx.globalCompositeOperation = "lighter";

      // halo
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size * 3.2, 0, Math.PI * 2);
      ctx.fillStyle = `hsla(${p.hue}, ${p.sat}%, ${Math.min(
        90,
        p.light + 20
      )}%, ${a * 0.08})`;
      ctx.fill();

      // inti
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fillStyle = `hsla(${p.hue}, ${p.sat}%, ${p.light}%, ${a})`;
      ctx.fill();

      ctx.globalCompositeOperation = "source-over";
    });
  }

  function loop(now) {
    const dt = Math.min(0.05, (now - last) / 1000); // batas 50ms
    last = now;
    step(dt);
    draw();
    requestAnimationFrame(loop);
  }

  function start() {
    resizeCanvas();
    spawnAll();
    last = performance.now();
    requestAnimationFrame(loop);
  }

  window.addEventListener("resize", () => {
    resizeCanvas();
    // jaga jumlah partikel konsisten saat resize
    spawnAll();
  });

  if (img.complete) start();
  else img.addEventListener("load", start);
})();

// ====== PARALLAX RINGAN UNTUK BACKGROUND ======
(function () {
  const root = document.getElementById("bg-anim");
  if (!root) return;

  const blobs = root.querySelectorAll(".blob");
  const aurora = root.querySelector(".aurora");
  let ticking = false;

  function onScroll() {
    if (ticking) return;
    ticking = true;
    requestAnimationFrame(() => {
      const y = window.scrollY || 0;
      const f = Math.min(1, y / 1200); // batas pengaruh
      // gerakkan pelan ke bawah (parallax)
      aurora && (aurora.style.transform = `translate3d(0, ${f * 6}px, 0)`);
      blobs.forEach((b, i) => {
        const k = i % 2 ? 10 : 6; // variasi kedalaman
        b.style.transform = `translate3d(0, ${f * k}px, 0)`; // scale/rotate tetap dari keyframes
      });
      ticking = false;
    });
  }
  window.addEventListener("scroll", onScroll, { passive: true });
  onScroll(); // initial
})();
/* ===== MODAL DETAIL PRODUK (paste di akhir script.js) ===== */
(function () {
  // Kalau modal belum ada di DOM, jangan jalan
  const modal = document.getElementById('detailModal');
  if (!modal) return;

  // Nomor WA tujuan
  const WA_NUMBER = '6285728527934';

  // Elemen-elemennya
  const backdrop   = document.getElementById('modalBackdrop');
  const closeBtn   = document.getElementById('closeModalBtn');
  const closeBtn2  = document.getElementById('detailClose2');

  const titleEl    = document.getElementById('detailTitle');
  const nameEl     = document.getElementById('detailName');
  const priceEl    = document.getElementById('detailPrice');
  const imgEl      = document.getElementById('detailImg');
  const descEl     = document.getElementById('detailDesc');
  const orderBtn   = document.getElementById('detailOrderBtn');

  // DETAILS boleh sudah ada dari file ini juga; kalau belum, inisialisasi kosong
  window.DETAILS = window.DETAILS || {};
  const DEFAULT_IMG = 'https://images.unsplash.com/photo-1519681393600-7e08d64b9dc3?q=80&w=1200&auto=format&fit=crop';

  // Utils
  const escapeHtml = (s='') => s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  const buildWaLink = (name, price) => {
    const text = `Halo Troppion, saya ingin pesan ${name || 'produk ini'}${price ? ' ('+price+')' : ''}.`;
    return `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(text)}`;
  };

function openModal(payload){
  const { id, dataTitle, img, dataDesc, cardId } = payload;

  // Cari dari DETAILS
  const fromDetails = (id && window.DETAILS && DETAILS[id]) ? DETAILS[id] : null;

  const title = (fromDetails?.title || dataTitle || '').trim();
  const descHTML = fromDetails?.desc
      ? fromDetails.desc // <-- ini HTML langsung dari DETAILS
      : (dataDesc ? `<p>${escapeHtml(dataDesc)}</p>` : '');

  titleEl.textContent = title || 'Detail Produk';
  nameEl.textContent  = title || '';
  priceEl.textContent = dataPrice || '';
  imgEl.src           = img || DEFAULT_IMG;
  imgEl.alt           = title || 'Gambar produk';

  // render deskripsi
  const backlink = cardId ? `<br><br><a href="#${cardId}" class="detail-backlink">Lihat produk di daftar</a>` : '';
  descEl.innerHTML = `${descHTML}${backlink}`;

  // link WA
  orderBtn.href = buildWaLink(title, dataPrice);

  modal.classList.remove('hidden');
  modal.setAttribute('aria-hidden','false');
  document.body.style.overflow = 'hidden';
}


  function closeModal(){
    modal.classList.add('hidden');
    modal.setAttribute('aria-hidden','true');
    document.body.style.overflow = '';
  }

  // Delegasi klik tombol “Detail”
  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('[data-open-detail]');
    if(!btn) return;

    const card = btn.closest('.product-card');
    const payload = {
      id:        (btn.dataset.id || '').trim(),
      dataTitle: btn.getAttribute('data-title') || card?.querySelector('h3')?.textContent || '',
      dataPrice: btn.getAttribute('data-price') || '',
      img:       btn.getAttribute('data-img') || '',
      dataDesc:  btn.getAttribute('data-desc') || '',
      cardId:    card?.id || ''
    };
    openModal(payload);
  });

  // Tutup modal
  closeBtn?.addEventListener('click', closeModal);
  closeBtn2?.addEventListener('click', closeModal);
  backdrop?.addEventListener('click', closeModal);
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && !modal.classList.contains('hidden')) closeModal(); });
})();
